SELECT
SEQN as respondent_sequence_number, -- could not identify transformation logic 

CASE
    WHEN SAFE_CAST(ROUND(SAFE_CAST(TBQ070 AS FLOAT64),0) AS INT64) = SAFE_CAST(ROUND(SAFE_CAST(1 AS FLOAT64),0) AS INT64) THEN 'Yes' -- categorize numeric values
WHEN SAFE_CAST(ROUND(SAFE_CAST(TBQ070 AS FLOAT64),0) AS INT64) = SAFE_CAST(ROUND(SAFE_CAST(2 AS FLOAT64),0) AS INT64) THEN 'No' -- categorize numeric values
WHEN TBQ070 IS NULL THEN NULL 
ELSE SAFE_CAST(TBQ070 AS STRING) 
 END as had_a_reaction_to_a_tb_skin_test, 

CASE
    WHEN TBDRUIND IS NULL THEN NULL 
ELSE SAFE_CAST(TBDRUIND AS FLOAT64) 
 END as induration_in_mm, 

CASE
    WHEN SAFE_CAST(ROUND(SAFE_CAST(TBXRUVES AS FLOAT64),0) AS INT64) = SAFE_CAST(ROUND(SAFE_CAST(1 AS FLOAT64),0) AS INT64) THEN 'Present' -- categorize numeric values
WHEN SAFE_CAST(ROUND(SAFE_CAST(TBXRUVES AS FLOAT64),0) AS INT64) = SAFE_CAST(ROUND(SAFE_CAST(2 AS FLOAT64),0) AS INT64) THEN 'Absent' -- categorize numeric values
WHEN SAFE_CAST(ROUND(SAFE_CAST(TBXRUVES AS FLOAT64),0) AS INT64) = SAFE_CAST(ROUND(SAFE_CAST(8 AS FLOAT64),0) AS INT64) THEN 'Could not obtain' -- categorize numeric values
WHEN TBXRUVES IS NULL THEN NULL 
ELSE SAFE_CAST(TBXRUVES AS STRING) 
 END as ppds_vesiculation, 

CASE
    WHEN SAFE_CAST(ROUND(SAFE_CAST(TBXRUULC AS FLOAT64),0) AS INT64) = SAFE_CAST(ROUND(SAFE_CAST(1 AS FLOAT64),0) AS INT64) THEN 'Present' -- categorize numeric values
WHEN SAFE_CAST(ROUND(SAFE_CAST(TBXRUULC AS FLOAT64),0) AS INT64) = SAFE_CAST(ROUND(SAFE_CAST(2 AS FLOAT64),0) AS INT64) THEN 'Absent' -- categorize numeric values
WHEN SAFE_CAST(ROUND(SAFE_CAST(TBXRUULC AS FLOAT64),0) AS INT64) = SAFE_CAST(ROUND(SAFE_CAST(8 AS FLOAT64),0) AS INT64) THEN 'Could not obtain' -- categorize numeric values
WHEN TBXRUULC IS NULL THEN NULL 
ELSE SAFE_CAST(TBXRUULC AS STRING) 
 END as ppds_ulceration, 

CASE
    WHEN SAFE_CAST(ROUND(SAFE_CAST(TBABCG AS FLOAT64),0) AS INT64) = SAFE_CAST(ROUND(SAFE_CAST(1 AS FLOAT64),0) AS INT64) THEN 'Present' -- categorize numeric values
WHEN SAFE_CAST(ROUND(SAFE_CAST(TBABCG AS FLOAT64),0) AS INT64) = SAFE_CAST(ROUND(SAFE_CAST(2 AS FLOAT64),0) AS INT64) THEN 'Absent' -- categorize numeric values
WHEN SAFE_CAST(ROUND(SAFE_CAST(TBABCG AS FLOAT64),0) AS INT64) = SAFE_CAST(ROUND(SAFE_CAST(3 AS FLOAT64),0) AS INT64) THEN 'Refused' -- categorize numeric values
WHEN TBABCG IS NULL THEN NULL 
ELSE SAFE_CAST(TBABCG AS STRING) 
 END as bcg_scar, 

CASE
    WHEN TBDPPDS IS NULL THEN NULL 
ELSE SAFE_CAST(TBDPPDS AS FLOAT64) 
 END as ppds_induration_mm, 

CASE
    WHEN TBDPPDB IS NULL THEN NULL 
ELSE SAFE_CAST(TBDPPDB AS FLOAT64) 
 END as ppdb_induration_mm, 

CASE
    WHEN SAFE_CAST(ROUND(SAFE_CAST(TBDPPDSV AS FLOAT64),0) AS INT64) = SAFE_CAST(ROUND(SAFE_CAST(1 AS FLOAT64),0) AS INT64) THEN 'vesiculation present - PPDS' -- categorize numeric values
WHEN SAFE_CAST(ROUND(SAFE_CAST(TBDPPDSV AS FLOAT64),0) AS INT64) = SAFE_CAST(ROUND(SAFE_CAST(2 AS FLOAT64),0) AS INT64) THEN 'vesiculation absent - PPDS' -- categorize numeric values
WHEN TBDPPDSV IS NULL THEN NULL 
ELSE SAFE_CAST(TBDPPDSV AS STRING) 
 END as ppds_vesiculation_TBDPPDSV, 

CASE
    WHEN SAFE_CAST(ROUND(SAFE_CAST(TBDPPDSU AS FLOAT64),0) AS INT64) = SAFE_CAST(ROUND(SAFE_CAST(1 AS FLOAT64),0) AS INT64) THEN 'ulceration present - PPDS' -- categorize numeric values
WHEN SAFE_CAST(ROUND(SAFE_CAST(TBDPPDSU AS FLOAT64),0) AS INT64) = SAFE_CAST(ROUND(SAFE_CAST(2 AS FLOAT64),0) AS INT64) THEN 'ulceration absent - PPDS' -- categorize numeric values
WHEN TBDPPDSU IS NULL THEN NULL 
ELSE SAFE_CAST(TBDPPDSU AS STRING) 
 END as ppds_ulceration_TBDPPDSU, 

CASE
    WHEN SAFE_CAST(ROUND(SAFE_CAST(TBDPPDBV AS FLOAT64),0) AS INT64) = SAFE_CAST(ROUND(SAFE_CAST(1 AS FLOAT64),0) AS INT64) THEN 'vesiculation present - PPDB' -- categorize numeric values
WHEN SAFE_CAST(ROUND(SAFE_CAST(TBDPPDBV AS FLOAT64),0) AS INT64) = SAFE_CAST(ROUND(SAFE_CAST(2 AS FLOAT64),0) AS INT64) THEN 'vesiculation absent - PPDB' -- categorize numeric values
WHEN TBDPPDBV IS NULL THEN NULL 
ELSE SAFE_CAST(TBDPPDBV AS STRING) 
 END as ppdb_vesiculation, 

CASE
    WHEN SAFE_CAST(ROUND(SAFE_CAST(TBDPPDBU AS FLOAT64),0) AS INT64) = SAFE_CAST(ROUND(SAFE_CAST(1 AS FLOAT64),0) AS INT64) THEN 'ulceration present - PPDB' -- categorize numeric values
WHEN SAFE_CAST(ROUND(SAFE_CAST(TBDPPDBU AS FLOAT64),0) AS INT64) = SAFE_CAST(ROUND(SAFE_CAST(2 AS FLOAT64),0) AS INT64) THEN 'ulceration absent - PPDB' -- categorize numeric values
WHEN TBDPPDBU IS NULL THEN NULL 
ELSE SAFE_CAST(TBDPPDBU AS STRING) 
 END as ppdb_ulceration, 

start_year,
end_year,
last_updated,
published_date,
parquet_filename,
data_file_url,
doc_file_url,
dataset,
 FROM {{ ref('stg_tuberculosis_examination') }}

/* 
Docs utilized to generate this SQL can be found at:
https://wwwn.cdc.gov/Nchs/Nhanes/2011-2012/TBX_G.htm
https://wwwn.cdc.gov/Nchs/Nhanes/1999-2000/TB.htm
*/
